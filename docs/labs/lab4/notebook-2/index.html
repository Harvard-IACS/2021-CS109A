<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
            name="description"
            content="Fall 2021 - Harvard University, Institute for Applied Computational Science. Lab 4"
    />
    <meta name="author" content="Pavlos Protopapas"/>
    <meta
            name="keywords"
            content="pandas"
    />

    <!-- Bootstrap CSS -->
    <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
            integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
            crossorigin="anonymous"
    />

    <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
            integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
            crossorigin="anonymous"
    />

    <link
            href="https://fonts.googleapis.com/css?family=Roboto+Condensed|Roboto:300,400,700"
            rel="stylesheet"
    />

    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css"
    />

    <link
            rel="stylesheet"
            href="../../../style/tipuesearch/tipuesearch.css"
    />

    <link
            rel="shortcut icon"
            type="image/x-icon"
            href="../../../style/images/favicon.ico"
    />
    <link rel="stylesheet" href="../../../style/css/iacs.css"/>

    <title>Harvard CS109A | Lab 4</title>

    <style>
        .navbar {
            background-color: #c90016
        }
    </style>
</head>
<body>
<nav class="navbar navbar-dark navbar-expand-md">
    <div class="container">
        <a class="navbar-brand" href="../../..">
            <img
                    class="navbar-brand-logo"
                    src="../../../style/images/logo.png"
            />
            <h3 class="course-title">CS109A</h3>
        </a>
        <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarsDefault"
                aria-controls="navbarsDefault"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsDefault">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="../../../pages/syllabus.html">Syllabus</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../../pages/schedule.html">Schedule</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../../pages/materials.html">Materials</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../../pages/faq.html">FAQ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../../pages/preparation.html">Preparation</a>
                </li>
                <form
                        class="form-inline my-2"
                        action="../../../search.html"
                        onsubmit="return validateForm(this.elements['q'].value);"
                >
                    <div class="input-group input-group-sm">
                        <input
                                class="form-control"
                                type="text"
                                name="q"
                                placeholder="Search Topic"
                        />
                        <div class="input-group-append">
                            <button class="btn btn-default" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </ul>
        </div>
        <!-- .collapse navbar-collapse -->
    </div>
    <!-- .container -->
</nav>
<main id="content" class="container">
    <div>
        <div class="float-left">
            <p>
                Key Word(s): <a href="../../../pages/materials.html#pandas"
            >pandas</a
            ></p>
        </div>
        <div class="float-right">
            <a href="../../../labs/lab4/cs109a_lab_04_students.ipynb">
                Download Notebook <i class="fas fa-download"></i>
            </a>
        </div>
    </div>
    <br/>
    <hr/>
    <style type="text/css">.highlight .hll {
        background-color: var(--jp-cell-editor-active-background)
    }

    .highlight {
        background: var(--jp-cell-editor-background);
        color: var(--jp-mirror-editor-variable-color)
    }

    .highlight .c {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment */
    .highlight .err {
        color: var(--jp-mirror-editor-error-color)
    }

    /* Error */
    .highlight .k {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword */
    .highlight .o {
        color: var(--jp-mirror-editor-operator-color);
        font-weight: bold
    }

    /* Operator */
    .highlight .p {
        color: var(--jp-mirror-editor-punctuation-color)
    }

    /* Punctuation */
    .highlight .ch {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.Hashbang */
    .highlight .cm {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.Multiline */
    .highlight .cp {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.Preproc */
    .highlight .cpf {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.PreprocFile */
    .highlight .c1 {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.Single */
    .highlight .cs {
        color: var(--jp-mirror-editor-comment-color);
        font-style: italic
    }

    /* Comment.Special */
    .highlight .kc {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Constant */
    .highlight .kd {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Declaration */
    .highlight .kn {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Namespace */
    .highlight .kp {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Pseudo */
    .highlight .kr {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Reserved */
    .highlight .kt {
        color: var(--jp-mirror-editor-keyword-color);
        font-weight: bold
    }

    /* Keyword.Type */
    .highlight .m {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number */
    .highlight .s {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String */
    .highlight .ow {
        color: var(--jp-mirror-editor-operator-color);
        font-weight: bold
    }

    /* Operator.Word */
    .highlight .w {
        color: var(--jp-mirror-editor-variable-color)
    }

    /* Text.Whitespace */
    .highlight .mb {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Bin */
    .highlight .mf {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Float */
    .highlight .mh {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Hex */
    .highlight .mi {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Integer */
    .highlight .mo {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Oct */
    .highlight .sa {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Affix */
    .highlight .sb {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Backtick */
    .highlight .sc {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Char */
    .highlight .dl {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Delimiter */
    .highlight .sd {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Doc */
    .highlight .s2 {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Double */
    .highlight .se {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Escape */
    .highlight .sh {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Heredoc */
    .highlight .si {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Interpol */
    .highlight .sx {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Other */
    .highlight .sr {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Regex */
    .highlight .s1 {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Single */
    .highlight .ss {
        color: var(--jp-mirror-editor-string-color)
    }

    /* Literal.String.Symbol */
    .highlight .il {
        color: var(--jp-mirror-editor-number-color)
    }

    /* Literal.Number.Integer.Long */</style>
    <body>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h1><img style="float: left; padding-right: 10px; width: 45px"
                     src="https://raw.githubusercontent.com/Harvard-IACS/2018-CS109A/master/content/styles/iacs.png">
                CS109A Introduction to Data Science</h1>

        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h2 id="Lab-4:-Multiple-Regression-and-Feature-engineering">Lab 4: Multiple Regression and Feature
                engineering<a class="anchor-link" href="#Lab-4:-Multiple-Regression-and-Feature-engineering">&#182;</a>
            </h2>
            <p><strong>Harvard University</strong><br/>
                <strong>Fall 2021</strong><br/>
                <strong>Instructors</strong>: Pavlos Protopapas and Natesh Pillai<br/>
                <strong>Lab Team</strong>: Marios Mattheakis, Hayden Joy, Chris Gumb, and Eleni Kaxiras<br/>
                <strong>Authors</strong>: Eleni Kaxiras, Rahul Dave, David Sondak, Will Claybaugh, and Pavlos Protopapas
            </p>
            <hr style='height:2px'>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## RUN THIS CELL TO GET THE RIGHT FORMATTING </span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span
                                    class="n">HTML</span>
<span class="n">styles</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span
                                    class="n">get</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/Harvard-IACS/2018-CS109A/master/content/styles/cs109.css&quot;</span><span
                                    class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h2 id="Learning-Objectives">Learning Objectives<a class="anchor-link"
                                                               href="#Learning-Objectives">&#182;</a></h2>
            <p>After this lab, you should be able to</p>
            <ul>
                <li>Implement multiple regression models with <code>sklearn</code>.</li>
                <li>Work with categorical variables including transforming them.</li>
                <li>Incorporate pipelines into your workflow</li>
            </ul>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span
                                class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span
                                    class="nn">plt</span>

<span class="c1"># from sklearn import preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span
                                    class="n">PolynomialFeatures</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span
                                    class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span
                                    class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span
                                    class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span
                                    class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span
                                    class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">pandas.api.types</span> <span class="kn">import</span> <span class="n">CategoricalDtype</span> 
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span><span
                                    class="p">,</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>

<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span
                                    class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span
                                    class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">scatter_matrix</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p><a class="anchor" id="soccer"></a></p>
            <h2 id="1---Exploring-the-Football-data">1 - Exploring the Football data<a class="anchor-link"
                                                                                       href="#1---Exploring-the-Football-data">&#182;</a>
            </h2>
        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Introduction">Introduction<a class="anchor-link" href="#Introduction">&#182;</a></h3>
            <p>The data imported below were scraped by <a
                    href="https://www.kaggle.com/mauryashubham/linear-regression-to-predict-market-value/data">Shubham
                Maurya</a> and record various facts about players in the English Premier League.</p>
            <h4 id="Our-goal-is-to-fit-models-that-predict-the-players'-market-value-(what-the-player-could-earn-when-hired-by-a-new-team).">
                Our goal is to fit models that predict the players' market value (what the player could earn when hired
                by a new team).<a class="anchor-link"
                                  href="#Our-goal-is-to-fit-models-that-predict-the-players'-market-value-(what-the-player-could-earn-when-hired-by-a-new-team).">&#182;</a>
            </h4>
            <p>There are all sorts of questions we could answer, for example is there a relationship between a player’s
                popularity and his market value? Or we could make interesting observations about players in the top 6
                teams.</p>
            <p>The data were scraped by <a
                    href="https://www.kaggle.com/mauryashubham/linear-regression-to-predict-market-value/data">Shubham
                Maurya</a> from a variety of sources, including <em>transfermrkt.com</em> and <em>Fantasy Premier League
                (FPL)</em>. They record various facts about players in the English Premier League.</p>
            <h4 id="Data-description">Data description<a class="anchor-link" href="#Data-description">&#182;</a></h4>
            <p><code>name</code>: Name of the player<br>
                <code>club</code>: Club of the player<br>
                <code>age</code> : Age of the player<br>
                <code>position</code> : The usual position on the pitch<br>
                <code>position_cat</code> : 1 for attackers, 2 for midfielders, 3 for defenders, 4 for goalkeepers<br>
                <code>page_views</code> : Average daily Wikipedia page views from September 1, 2016 to May 1, 2017<br>
                <code>fpl_points</code> : FPL points accumulated over the previous season<br>
                <code>region</code>: 1 for England, 2 for EU, 3 for Americas, 4 for Rest of World<br>
                <code>nationality</code>: Player's nationality <BR>
                <code>new_signing</code>: Whether a new signing for 2017/18 (till 20th July)<br>
                <code>new_foreign</code>: Whether a new signing from a different league, for 2017/18 (till 20th
                July)<br>
                <code>club_id</code>: a numerical version of the Club feature</p>
            <p><strong>Our return variable</strong></p>
            <p><code>market_value</code>: As on transfermrkt.com on July 20th, 2017</p>

        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h4 id="Import-the-data">Import the data<a class="anchor-link" href="#Import-the-data">&#182;</a></h4>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span> <span
                                class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span
                                class="p">(</span><span class="s2">&quot;league_data.csv&quot;</span><span
                                class="p">)</span>
<span class="n">league_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span
                                class="n">sum</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h4 id="We-have-not-talked-about-handling-missing-values-so-we-will-just-drop-this-here.">We have not talked
                about handling missing values so we will just drop this here.<a class="anchor-link"
                                                                                href="#We-have-not-talked-about-handling-missing-values-so-we-will-just-drop-this-here.">&#182;</a>
            </h4>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span> <span
                                class="o">=</span> <span class="n">league_df</span><span class="o">.</span><span
                                class="n">dropna</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span
                                class="n">sum</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span
                                class="o">=</span> <span class="s1">&#39;market_value&#39;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">league_df</span><span class="p">[</span><span
                                    class="n">response</span><span class="p">]</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">describe</span><span class="p">(</span><span
                                class="n">include</span><span class="o">=</span><span
                                class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <div class="alert alert-success">
                <strong>🏋🏻‍♂️ TEAM ACTIVITY 1:</strong> Let's start with some feature engineering.
            </div>
            <ol>
                <li>The people that hired us to predict on this data want to know if being in a big club affects the
                    market value of a player. So we need to create a new binary categorical variable named <code>big_clubs</code>
                    with values $0$ or $1$ designating if a club belongs to the Top 6 clubs:
                    <pre><code>big_clubs = ['Arsenal', 'Chelsea', 'Liverpool', 'Manchester+City',
     'Manchester+United', 'Tottenham']</code></pre>
                </li>
                <li>They also want to look at players in age groups and not just by age. Put the <code>age</code>
                    feature in bins according to the values below, and name the variable <code>age_cat</code>:
                    <BR>
                    <img src="age_cats.png" alt="age_cats">
                    <BR>
                    <code>pandas</code> has the <a href="#https://pandas.pydata.org/docs/reference/api/pandas.cut.html"><code>.cut()</code></a>
                    method that breaks a variable into <code>bins</code> with <code>labels</code>
                    <pre><code>age_bins = [___]
age_labels = [___]
league_df['age_cat'] = pd.cut(x=league_df['age'],\
                              bins=age_bins, 
                              labels=age_labels)</code></pre>
                </li>
            </ol>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="c1"># 1. your code here</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check</span>
<span class="nb">list</span><span class="p">(</span><span class="n">league_df</span><span class="p">[[</span><span
                                    class="s1">&#39;club&#39;</span><span class="p">,</span> <span class="s1">&#39;big_club&#39;</span><span
                                    class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span
                                    class="p">([</span><span class="s1">&#39;big_club&#39;</span><span
                                    class="p">])</span><span class="o">.</span><span class="n">apply</span><span
                                    class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span
                                    class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h4 id="Applying-functions-to-pandas-DataFrames-and-Series">Applying functions to pandas DataFrames and
                Series<a class="anchor-link" href="#Applying-functions-to-pandas-DataFrames-and-Series">&#182;</a></h4>
            <p>A simpler but less generic way to do the previous exercise would be</p>

            <pre><code>league_df['big_club2'] = league_df.apply(lambda row: 1 if row['club'] in big_clubs else 0, axis=1)</code></pre>
            <p>If the function to create the new column is simple, there is a more direct way to create the new column
                (feature), e.g.:</p>

            <pre><code>df['new_column'] = df['column']**2</code></pre>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="c1"># 2. your code here</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check</span>
<span class="nb">list</span><span class="p">(</span><span class="n">league_df</span><span class="p">[[</span><span
                                    class="s1">&#39;age_cat&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span
                                    class="p">,</span> <span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span
                                    class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;age_cat&#39;</span><span
                                    class="p">)</span><span class="o">.</span><span class="n">groupby</span><span
                                    class="p">([</span><span class="s1">&#39;age_cat&#39;</span><span
                                    class="p">])</span><span class="o">.</span><span class="n">apply</span><span
                                    class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span
                                    class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Looking-at-data-types-more-closely">Looking at data types more closely<a class="anchor-link"
                                                                                             href="#Looking-at-data-types-more-closely">&#182;</a>
            </h3>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">dtypes</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># let&#39;s see what features we want to use in the model</span>
<span class="n">categorical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;position_cat&#39;</span><span
                                    class="p">,</span> <span class="s1">&#39;new_signing&#39;</span><span
                                    class="p">,</span> <span class="s1">&#39;big_club&#39;</span><span
                                    class="p">,</span> <span class="s1">&#39;age_cat&#39;</span><span class="p">,</span> <span
                                    class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="c1"># non-ordinal</span>
<span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span
                                    class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;page_views&#39;</span><span
                                    class="p">,</span> <span class="s1">&#39;fpl_points&#39;</span><span
                                    class="p">]</span>
<span class="n">ordinal_cols</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># we do not have any</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># cast categorical variables as pandas type `category`</span>
<span class="n">cat_type</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span
                                    class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span
                                    class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_cols</span><span
                                    class="p">:</span>
    <span class="n">league_df</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span
                                    class="o">=</span> <span class="n">league_df</span><span class="p">[</span><span
                                    class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span
                                    class="p">(</span><span class="n">cat_type</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">league_df</span><span
                                class="p">[</span><span class="n">categorical_cols</span><span class="o">+</span><span
                                class="n">numerical_cols</span><span class="p">]</span><span class="o">.</span><span
                                class="n">dtypes</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Shape of things</span>
<span class="n">league_df</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span
                                    class="n">values</span><span class="o">.</span><span class="n">reshape</span><span
                                    class="p">(</span><span class="o">-</span><span class="mi">1</span><span
                                    class="p">,</span><span class="mi">1</span><span class="p">)</span><span
                                    class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Stratified-train/test-split">Stratified train/test split<a class="anchor-link"
                                                                               href="#Stratified-train/test-split">&#182;</a>
            </h3>
            <p>We want to split before we do any EDA since, ideally, we do not want our test set to influence our design
                decisions. Also, to make sure that the training and test data have appropriate representation of each
                region; it would be bad for the training data to entirely miss a region. This is especially important
                because some regions are rather rare.</p>

            <pre><code>train and test subsets = sklearn.model_selection.train_test_split(*arrays, test_size=None, train_size=None, random_state=None, shuffle=True, stratify=None)[source]</code></pre>
            <p>
                <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html</a>
            </p>

        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <div class="alert alert-success">
                <strong>🏋🏻‍♂️ TEAM ACTIVITY 2:</strong> Practice stratified train-test split. Stratify by `region`.
            </div>
            <p>Use the <code>train_test_split</code> function and its <code>stratify</code> argument to split the data,
                keeping equal representation of each region.<br>Note: This will not work if the dataset contains missing
                data.</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># your code here</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check</span>
<span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span
                                    class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span
                                    class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span
                                    class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span
                                    class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p>Now that we won't be peeking at the test set, let's explore and look for patterns! We'll practice a
                number of useful pandas and numpy functions along the way.</p>
            <p>We notice that our dataset contains columns with different data types. We need to apply a specific
                preprocessing for each one of them. Categorical variables that are ordinal need to be coded as integers,
                while the rest of them need to be one-hot-encoded. We can do this sequentially or better use sklearn's
                <code>pipeline</code> structure. Our pipeline could conveniently include any
                standardization/normalisation of numerical values. For now we will let them as they are.</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span
                                class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span
                                class="n">pairplot</span><span class="p">(</span><span class="n">train_data</span><span
                                class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span
                                class="s1">&#39;page_views&#39;</span><span class="p">,</span> <span class="s1">&#39;market_value&#39;</span><span
                                class="p">]],</span> \
                                  <span class="n">kind</span><span class="o">=</span><span
                                    class="s1">&#39;reg&#39;</span><span class="p">,</span> <span
                                    class="n">diag_kind</span><span class="o">=</span><span
                                    class="s1">&#39;hist&#39;</span><span class="p">);</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span
                                class="o">.</span><span class="n">columns</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span
                                class="p">[[</span><span class="s1">&#39;club&#39;</span><span class="p">,</span><span
                                class="s1">&#39;club_id&#39;</span><span class="p">]]</span><span class="o">.</span>\
                                <span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;club_id&#39;</span><span
                                    class="p">])</span><span class="o">.</span><span class="n">agg</span><span
                                    class="p">({</span><span class="s1">&#39;club&#39;</span> <span
                                    class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span
                                    class="p">,</span>
                                                        <span class="p">})</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span
                                class="o">.</span><span class="n">groupby</span><span class="p">(</span><span
                                class="s1">&#39;position&#39;</span><span class="p">)</span><span
                                class="o">.</span><span class="n">agg</span><span class="p">({</span>
                                <span class="s1">&#39;market_value&#39;</span><span class="p">:</span> <span class="n">np</span><span
                                    class="o">.</span><span class="n">mean</span><span class="p">,</span>
                                <span class="s1">&#39;page_views&#39;</span><span class="p">:</span> <span
                                    class="n">np</span><span class="o">.</span><span class="n">median</span><span
                                    class="p">,</span>
                                <span class="s1">&#39;fpl_points&#39;</span><span class="p">:</span> <span
                                    class="n">np</span><span class="o">.</span><span class="n">max</span>
<span class="p">})</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p><a class="anchor" id="pipe"></a></p>
            <h2 id="2---Transform-categorical-variables">2 - Transform categorical variables<a class="anchor-link"
                                                                                               href="#2---Transform-categorical-variables">&#182;</a>
            </h2>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="n">categorical_cols</span><span class="p">,</span> <span
                                class="n">numerical_cols</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span> <span
                                class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span
                                class="n">categorical_cols</span><span class="o">+</span><span
                                class="n">numerical_cols</span><span class="p">]</span><span class="o">.</span><span
                                class="n">copy</span><span class="p">()</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span
                                    class="n">categorical_cols</span><span class="o">+</span><span class="n">numerical_cols</span><span
                                    class="p">]</span><span class="o">.</span><span class="n">copy</span><span
                                    class="p">()</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span
                                    class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span
                                    class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span
                                    class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span
                                    class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Using-sklearn-OneHotEncoder()">Using sklearn <code>OneHotEncoder()</code><a class="anchor-link"
                                                                                                href="#Using-sklearn-OneHotEncoder()">&#182;</a>
            </h3>
            <p>By default, keeps all one-hot created columns. Fine-grained drop mechanism, can drop only binary
                variables, or the first in the list of categories, or even a specific one ($cats[i]$).</p>

            <pre><code>drop{‘first’, ‘if_binary’} or a array-like of shape (n_features,), default=None</code></pre>
            <p>It also has a mechanism for handling the presence of unknown categories in the test set.</p>

            <pre><code>handle_unknown{‘error’, ‘ignore’}, default=’error’</code></pre>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">oh</span> <span class="o">=</span> <span
                                class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span
                                class="o">=</span><span class="s1">&#39;if_binary&#39;</span><span
                                class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span
                                class="kc">False</span><span class="p">,</span> <span
                                class="n">handle_unknown</span><span class="o">=</span><span
                                class="s1">&#39;error&#39;</span><span class="p">)</span>
<span class="n">oh_train</span> <span class="o">=</span> <span class="n">oh</span><span class="o">.</span><span
                                    class="n">fit_transform</span><span class="p">(</span><span
                                    class="n">train_data</span><span class="p">[</span><span
                                    class="n">categorical_cols</span><span class="p">])</span>
<span class="n">oh_train</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span
                                class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">categorical_cols</span><span
                                class="p">,</span> <span class="n">oh</span><span class="o">.</span><span class="n">categories_</span><span
                                class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">oh_train</span><span
                                class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_data</span><span
                                class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span><span
                                class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">oh_test</span> <span
                                class="o">=</span> <span class="n">oh</span><span class="o">.</span><span class="n">transform</span><span
                                class="p">(</span><span class="n">test_data</span><span class="p">[</span><span
                                class="n">categorical_cols</span><span class="p">])</span>
<span class="n">oh_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span
                                    class="n">test_data</span><span class="p">[</span><span
                                    class="n">categorical_cols</span><span class="p">]</span><span
                                    class="o">.</span><span class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># remember these are &quot;views&quot; of the dataframe</span>
<span class="c1"># the dataframe remains unchanged</span>
<span class="n">train_data</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span><span
                                    class="o">.</span><span class="n">head</span><span class="p">(</span><span
                                    class="mi">5</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span
                                class="p">[</span><span class="n">numerical_cols</span><span class="p">]</span><span
                                class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span
                                class="p">,</span> <span class="n">oh_train</span><span class="o">.</span><span
                                class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Using-pandas-get_dummies()">Using pandas <code>get_dummies()</code><a class="anchor-link"
                                                                                          href="#Using-pandas-get_dummies()">&#182;</a>
            </h3>
            <p>By default keeps all $k$ dummies out of $k$ categorical levels. Can be made to remove the first level, so
                that we have $k-1 dummies$.</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">dummies_train</span> <span
                                class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span
                                class="p">(</span><span class="n">train_data</span><span class="p">[</span><span
                                class="n">categorical_cols</span><span class="p">])</span> <span class="c1">#drop_first=True</span>
<span class="n">dummies_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="c1"># transform the test set</span>
<span class="n">dummies_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span
                                    class="n">get_dummies</span><span class="p">(</span><span class="n">test_data</span><span
                                    class="p">[</span><span class="n">categorical_cols</span><span class="p">])</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p><strong>Note</strong>: if the test dataset has a category that does not exist in the training set, this
                will throw an error.</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span
                                class="o">.</span><span class="n">set_option</span><span class="p">(</span><span
                                class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span
                                class="kc">None</span><span class="p">)</span>
<span class="c1"># create the design matrix for the train set</span>
<span class="n">design_train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span
                                    class="n">concat</span><span class="p">([</span><span
                                    class="n">train_data</span><span class="p">[</span><span
                                    class="n">numerical_cols</span><span class="p">],</span> <span class="n">dummies_train</span><span
                                    class="p">],</span> <span class="n">axis</span><span class="o">=</span><span
                                    class="mi">1</span><span class="p">)</span>
<span class="n">design_train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># for the test set</span>
<span class="n">design_test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span
                                    class="n">concat</span><span class="p">([</span><span
                                    class="n">test_data</span><span class="p">[</span><span
                                    class="n">numerical_cols</span><span class="p">],</span> <span class="n">dummies_test</span><span
                                    class="p">],</span> <span class="n">axis</span><span class="o">=</span><span
                                    class="mi">1</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="n">design_train_df</span><span class="o">.</span><span class="n">dtypes</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># the dataframe remains unchanged</span>
<span class="n">train_data</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span><span
                                    class="o">.</span><span class="n">head</span><span class="p">(</span><span
                                    class="mi">5</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span
                                class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">categorical_cols</span><span
                                class="p">,</span> <span class="n">oh</span><span class="o">.</span><span class="n">categories_</span><span
                                class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h4 id="Now,-let's-run-the-model-using-our-design-matrices">Now, let's run the model using our design
                matrices<a class="anchor-link" href="#Now,-let's-run-the-model-using-our-design-matrices">&#182;</a>
            </h4>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="c1">#create linear model</span>
<span class="n">regression</span> <span class="o">=</span> <span class="n">LinearRegression</span><span
                                    class="p">()</span>

<span class="c1">#fit linear model</span>
<span class="n">regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span
                                    class="n">design_train_df</span><span class="p">,</span> <span
                                    class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">regression</span><span class="o">.</span><span
                                    class="n">predict</span><span class="p">(</span><span
                                    class="n">design_test_df</span><span class="p">)</span>

<span class="n">r2_train</span> <span class="o">=</span> <span class="n">regression</span><span class="o">.</span><span
                                    class="n">score</span><span class="p">(</span><span class="n">design_train_df</span><span
                                    class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">r2_test</span> <span class="o">=</span> <span class="n">regression</span><span class="o">.</span><span
                                    class="n">score</span><span class="p">(</span><span
                                    class="n">design_test_df</span><span class="p">,</span> <span
                                    class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span
                                    class="s1">&#39;R^2 train = </span><span class="si">{</span><span
                                    class="n">r2_train</span><span class="si">:</span><span class="s1">.5</span><span
                                    class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span
                                    class="s1">&#39;R^2 test = </span><span class="si">{</span><span
                                    class="n">r2_test</span><span class="si">:</span><span class="s1">.5</span><span
                                    class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p><a class="anchor" id="pipes"></a></p>
            <h2 id="3---Using-Transformation-Pipelines">3 - Using Transformation Pipelines<a class="anchor-link"
                                                                                             href="#3---Using-Transformation-Pipelines">&#182;</a>
            </h2>
        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p>There could be many transformations that need to be executed sequentialy in order to construct the design
                matrix. As we saw, it is possible to handcraft the design matrix ourselves by transforming individual
                columns, it is more efficient and error-free to create an sklearn <code>pipeline</code> to do this for
                you. Sklearn can work directly with $numpy$ arrays or $DataFrames$.</p>
            <p>When using the latter, <code>sklearn.compose.ColumnTransformer</code> is useful, as it applies
                transformers to columns of an array or pandas DataFrame. This estimator allows different columns or
                column subsets of the input to be transformed separately and the features generated by each transformer
                will be concatenated to form the design matrix.</p>
            <h4 id="Making-a-pipeline">Making a pipeline<a class="anchor-link" href="#Making-a-pipeline">&#182;</a></h4>
            <pre><code>from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler

my_pipeline = Pipeline([
        ('imputer', Imputer(strategy='median')),      # we will be using later
        ('std_scaler', StandardScaler()),             # optional
        ('selector', ColumnTransformer())             # for one-hot encoding
        ('regressor', lr)                             # actual regressor model
])</code></pre>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span
                                class="c1"># transform categoricals</span>
<span class="n">categorical_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span
                                    class="n">drop</span><span class="o">=</span><span
                                    class="s1">&#39;if_binary&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span
                                    class="o">=</span><span class="s1">&#39;error&#39;</span><span
                                    class="p">)</span> <span class="c1">#handle_unknown=&#39;ignore&#39;</span>

<span class="c1"># transform numericals</span>
<span class="n">numerical_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span
                                    class="n">SimpleImputer</span><span class="p">(</span><span
                                    class="n">strategy</span><span class="o">=</span><span
                                    class="s1">&#39;mean&#39;</span><span class="p">)),</span>     <span class="c1"># for later</span>
                    <span class="c1">#(&#39;stdscaler&#39;, StandardScaler())                 # for later</span>
<span class="p">])</span>

<span class="c1"># bring all transformations together</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span
                                    class="p">([</span>
               <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_encoder</span><span
                                    class="p">,</span> <span class="n">categorical_cols</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numerical_pipe</span><span
                                    class="p">,</span> <span class="n">numerical_cols</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># add a regressor</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span
                                    class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="n">lr</span><span
                                    class="p">)</span>
<span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span
                                    class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">ohe</span> <span
                                class="o">=</span> <span class="p">(</span><span class="n">model</span><span
                                class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span
                                class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span
                                class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span
                                class="p">])</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span
                                    class="n">get_feature_names</span><span class="p">(</span><span class="n">input_features</span><span
                                    class="o">=</span><span class="n">categorical_cols</span><span class="p">)</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span
                                    class="n">r_</span><span class="p">[</span><span class="n">feature_names</span><span
                                    class="p">,</span> <span class="n">numerical_cols</span><span class="p">]</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span
                                    class="n">feature_names</span><span class="p">)</span>
<span class="n">feature_names</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span
                                class="p">(</span><span class="sa">f</span><span
                                class="s1">&#39;LR train R^2: </span><span class="si">{</span><span
                                class="n">model</span><span class="o">.</span><span class="n">score</span><span
                                class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span
                                class="n">y_train</span><span class="p">)</span><span class="si">:</span><span
                                class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span
                                class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LR test R^2: </span><span
                                    class="si">{</span><span class="n">model</span><span class="o">.</span><span
                                    class="n">score</span><span class="p">(</span><span class="n">X_test</span><span
                                    class="p">,</span> <span class="n">y_test</span><span class="p">)</span><span
                                    class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span
                                    class="s1">&#39;</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># grab the linear regressor</span>
<span class="n">linear_regressor</span> <span class="o">=</span> <span class="n">model</span><span
                                    class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span
                                    class="s1">&#39;regressor&#39;</span><span class="p">]</span>
<span class="n">linear_regressor</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span
                                    class="n">shape</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span
                                class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span
                                class="nb">zip</span><span class="p">(</span><span class="n">feature_names</span><span
                                class="o">+</span><span class="n">numerical_cols</span><span class="p">,</span> <span
                                class="n">linear_regressor</span><span class="o">.</span><span
                                class="n">coef_</span><span class="p">),</span> <span class="n">columns</span><span
                                class="o">=</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span
                                class="p">,</span> <span class="s1">&#39;coeff&#39;</span><span class="p">])</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h4 id="A-different-way-to-construct-the-pipeline">A different way to construct the pipeline<a
                    class="anchor-link" href="#A-different-way-to-construct-the-pipeline">&#182;</a></h4>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocessor</span> <span
                                class="o">=</span> <span class="n">make_column_transformer</span><span
                                class="p">(</span>
         <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span
                                    class="o">=</span><span class="s1">&#39;if_binary&#39;</span><span
                                    class="p">,</span> <span class="n">handle_unknown</span><span
                                    class="o">=</span><span class="s1">&#39;error&#39;</span><span
                                    class="p">),</span> <span class="n">categorical_cols</span><span class="p">),</span>
         <span class="c1">#(StandardScaler(), numerical_columns),</span>
         <span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span
                                    class="n">strategy</span><span class="o">=</span><span
                                    class="s1">&#39;mean&#39;</span><span class="p">),</span> <span class="n">numerical_cols</span><span
                                    class="p">),</span>
         <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span>
<span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span
                                class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span
                                    class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_names</span> <span
                                class="o">=</span> <span class="p">(</span><span class="n">model</span><span
                                class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span
                                class="s1">&#39;columntransformer&#39;</span><span class="p">]</span>
                      <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span
                                    class="s1">&#39;onehotencoder&#39;</span><span class="p">]</span>
                      <span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span
                                    class="n">input_features</span><span class="o">=</span><span class="n">categorical_cols</span><span
                                    class="p">))</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span
                                    class="n">concatenate</span><span class="p">(</span>
    <span class="p">[</span><span class="n">feature_names</span><span class="p">,</span> <span
                                    class="n">numerical_cols</span><span class="p">])</span>

<span class="n">coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span
                                    class="p">(</span>
    <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span
                                    class="s1">&#39;linearregression&#39;</span><span class="p">]</span><span class="o">.</span><span
                                    class="n">coef_</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Coefficients&#39;</span><span
                                    class="p">],</span> <span class="n">index</span><span class="o">=</span><span
                                    class="n">feature_names</span>
<span class="p">)</span>

<span class="n">coefs</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span
                                class="p">(</span><span class="sa">f</span><span
                                class="s1">&#39;LR train R^2: </span><span class="si">{</span><span
                                class="n">model</span><span class="o">.</span><span class="n">score</span><span
                                class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span
                                class="n">y_train</span><span class="p">)</span><span class="si">:</span><span
                                class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span
                                class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LR test R^2: </span><span
                                    class="si">{</span><span class="n">model</span><span class="o">.</span><span
                                    class="n">score</span><span class="p">(</span><span class="n">X_test</span><span
                                    class="p">,</span> <span class="n">y_test</span><span class="p">)</span><span
                                    class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span
                                    class="s1">&#39;</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <p><a class="anchor" id="linear"></a></p>
            <h2 id="4---Feature-Engineering">4 - Feature Engineering<a class="anchor-link"
                                                                       href="#4---Feature-Engineering">&#182;</a></h2>
        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <div class="alert alert-success">
                <strong>🏋🏻‍♂️ TEAM ACTIVITY 4:</strong></div>
            <p>Let's focus on introducing new features to see if our model performs better. After talking to our client
                for four hours and doing some some thought, we concluded that the mean predicted market value should
                be:</p>
            $$\hat{y} = \beta_0 + \beta_1\cdot \text{fpl_points} + \beta_2\cdot\text{age} + \beta_3\cdot\text{age}^2 +
            \beta_4\cdot \text{new_signing} +\beta_5\cdot \text{big_club} + \beta_6\cdot \text{position_cat} \\ +
            \beta_7\cdot \text{age_cat} + \beta_8\cdot \text{page_views}\times \text{fpl_points}$$<p>We're including a
            2nd degree polynomial in age because we expect pay to increase as a player gains experience, but then
            decrease as they continue aging. We also include an interaction term between <code>page_views</code> and
            <code>fpl_points</code>.</p>
            <ol>
                <li>Build a design matrix function and fit this model to the training data. How good is the overall
                    model?
                </li>
                <li>Interpret the regression model. What is the meaning of the coefficient for:
                    <ul>
                        <li>age and age$^2$</li>
                        <li>big_club</li>
                    </ul>
                </li>
                <li>What should a player do in order to improve their market value? How many page views should a player
                    go get to increase their market value by 10?
                </li>
            </ol>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># load a fresh train and test set.</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span
                                    class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train_data.csv&quot;</span><span
                                    class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span
                                    class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_data.csv&quot;</span><span
                                    class="p">)</span>
<span class="n">train_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span
                                    class="mi">2</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># your code here</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span
                                    class="s1">&#39;LR train R^2: </span><span class="si">{</span><span
                                    class="n">model</span><span class="o">.</span><span class="n">score</span><span
                                    class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span
                                    class="n">y_train</span><span class="p">)</span><span class="si">:</span><span
                                    class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span
                                    class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LR test R^2: </span><span
                                    class="si">{</span><span class="n">model</span><span class="o">.</span><span
                                    class="n">score</span><span class="p">(</span><span class="n">X_test</span><span
                                    class="p">,</span> <span class="n">y_test</span><span class="p">)</span><span
                                    class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span
                                    class="s1">&#39;</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Conceptual-questions">Conceptual questions<a class="anchor-link"
                                                                 href="#Conceptual-questions">&#182;</a></h3>
            <ol>
                <li>The model is reasonably good. We're capturing about 76% of the variation in market values, and the
                    test set confirms that we're not overfitting too badly.
                </li>
                <li>Look at the coefficients, depends upon your split..</li>
                <li>Linear regression on non-experimental data can't determine causation, so we can't prove that a given
                    relationship runs in the direction we might think. For instance, doing whatever it takes to get more
                    page views probably doesn't meaningfully increase market value; it's likely the causation runs in
                    the other direction and great players get more views. Even so, we can use page views to help us tell
                    who is a great player and thus likely to be paid well.
                </li>
            </ol>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">agecoef</span> <span
                                class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coefs</span><span
                                class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span
                                class="p">]</span><span class="o">.</span><span class="n">values</span><span
                                class="p">)</span>
<span class="n">age2coef</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span
                                    class="n">coefs</span><span class="o">.</span><span class="n">loc</span><span
                                    class="p">[</span><span class="s1">&#39;age_sq&#39;</span><span
                                    class="p">]</span><span class="o">.</span><span class="n">values</span><span
                                    class="p">)</span>
<span class="n">agecoef</span><span class="p">,</span> <span class="n">age2coef</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[0]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_vals</span> <span
                                class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span
                                class="p">(</span><span class="o">-</span><span class="mi">100</span><span
                                class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span
                                class="p">)</span>
<span class="n">y_vals</span> <span class="o">=</span> <span class="n">agecoef</span><span class="o">*</span><span
                                    class="n">x_vals</span> <span class="o">+</span><span class="n">age2coef</span><span
                                    class="o">*</span><span class="n">x_vals</span><span class="o">**</span><span
                                    class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span
                                    class="p">,</span> <span class="n">y_vals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effect of Age on Player Market value&quot;</span><span
                                    class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span
                                    class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Contribution to Predicted Market Value&quot;</span><span
                                    class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Conceptual-questions">Conceptual questions<a class="anchor-link"
                                                                 href="#Conceptual-questions">&#182;</a></h3>
            <ol>
                <li>If our model does not have a constant, we must include all four dummy variable columns. If we drop
                    one, we're not modeling any effect of being in that category, and effectively assuming the dropped
                    category's effect is 0.
                </li>
                <li>Being in position 2 (instead of position 1) has an impact between -1.54 and +2.38 on a player's
                    market value. Since we're using an intercept, the dropped category becomes the baseline and the
                    effect of any dummy variable is the effect of being in that category instead of the baseline
                    category.
                </li>
            </ol>

        </div>
    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="END-OF-LAB-04">END OF LAB 04<a class="anchor-link" href="#END-OF-LAB-04">&#182;</a></h3>
        </div>
    </div>


    </body>
    <script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: true," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            " linebreaks: { automatic: true, width: '95% container' }, " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
    </script>
</main>

<footer class="footer">
    <div class="container">
    <span class="text-muted">Copyright 2018 &copy;
      <a class="text-muted" href="https://iacs.seas.harvard.edu/">Institute for Applied Computational Science</a>
    </span>
    </div>
</footer>     <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"
></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"
></script>
</body>
</html>